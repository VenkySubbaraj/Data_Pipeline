name: Sync Code

on:
  push:
    branches:
      - master  # Change this to your desired branch

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source repository
        uses: actions/checkout@v2
        with:
          repository: VenkySubbaraj/Data_Pipeline

      - name: Checkout destination repository
        uses: actions/checkout@v2
        with:
          repository: venkatsubbaraj/clone
          token: ${{ secrets.DESTINATION_REPO_TOKEN }}
      
      - name: remove code from repository
        run: |
          rm -rf ${{ github.workspace }}
          mkdir -p ${{ github.workspace }}
          git clone --depth 1 https://github.com/venkatsubbaraj/clone.git ${{ github.workspace }}
          
      - name: Sync code
        run: |
          rsync -Rr ${{ github.workspace }}/. ${{ github.workspace }}/destination/
          git add .
          git config user.name "venkatsubbaraj"
          git config user.email "venkatachalapathysubbaraj@outlook.com"
          git commit -m "Sync code from source repository"
          git push
